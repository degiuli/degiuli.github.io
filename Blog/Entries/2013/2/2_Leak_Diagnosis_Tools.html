<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    
    <meta name="Generator" content="iWeb 2.0.4" />
    <meta name="iWeb-Build" content="local-build-20130324" />
    <meta name="viewport" content="width=700" />
    <title>Windows Debugging Series</title>
    <link rel="stylesheet" type="text/css" media="screen,print" href="2_Leak_Diagnosis_Tools_files/2_Leak_Diagnosis_Tools.css" />
    <!--[if IE]><link rel='stylesheet' type='text/css' media='screen,print' href='2_Leak_Diagnosis_Tools_files/2_Leak_Diagnosis_ToolsIE.css'/><![endif]-->
    <script language="javascript" type="text/javascript"><!--

iWebBlogMainPageName = 'Blog.html';
iWebBlogMainPageTitle = 'Blog';
iWebBlogArchivePageName = 'Archive.html';
iWebBlogArchivePageTitle = 'Archive';
iWebBlogFeedType = 'static';


--></script>
    <script type="text/javascript" src="../../../../Scripts/iWebSite.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Widgets/SharedResources/WidgetCommon.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Widgets/Navbar/navbar.js"></script>
    <script type="text/javascript" src="http://www.me.com/1/up/comments/scripts/search.js"></script>
    <script type="text/javascript" src="../../../../Scripts/iWebBlog.js"></script>
    <script type="text/javascript" src="../../../../Scripts/iWebImage.js"></script>
    <script type="text/javascript" src="2_Leak_Diagnosis_Tools_files/2_Leak_Diagnosis_Tools.js"></script>
  </head>
  <body style="background: #ffffff url(2_Leak_Diagnosis_Tools_files/PhotoGray_browser_bg-3.jpg) repeat scroll top left; margin: 0pt; " onload="onPageLoad();" onunload="onPageUnload();">
    <div style="text-align: center; ">
      <div style="margin-bottom: 0px; margin-left: auto; margin-right: auto; margin-top: 0px; overflow: hidden; position: relative; word-wrap: break-word;  text-align: left; width: 700px; " id="body_content">
        <div style="background: transparent url(2_Leak_Diagnosis_Tools_files/PhotoGray_bg_c-1.jpg) repeat scroll top left; width: 700px; ">
          <div style="margin-left: 0px; position: relative; width: 700px; z-index: 0; " id="nav_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
            <div style="height: 700px; width: 700px;  height: 700px; left: 0px; position: absolute; top: -80px; width: 700px; z-index: 1; " class="tinyText style_SkipStroke">
              <img src="2_Leak_Diagnosis_Tools_files/Darkroom_spotlight.jpg" alt="" style="border: none; height: 700px; width: 700px; " />
            </div>
            <div style="height: 1px; line-height: 1px; " class="tinyText"> </div>
            <div class="com-apple-iweb-widget-navbar flowDefining" id="widget0" style="margin-left: 0px; margin-top: 19px; position: relative; width: 700px; z-index: 1; ">
    
              <div id="widget0-navbar" class="navbar">

      
                <div id="widget0-bg" class="navbar-bg">

        
                  <ul id="widget0-navbar-list" class="navbar-list">
 <li></li> 
</ul>
                  
      
</div>
                
    
</div>
            </div>
            <script type="text/javascript"><!--//--><![CDATA[//><!--
new NavBar('widget0', '../../../../Scripts/Widgets/Navbar', '../../../../Scripts/Widgets/SharedResources', '../../../..', {"path-to-root": "..\/..\/..\/..\/", "navbar-css": ".navbar {\n\tfont-family: Futura, 'Trebuchet MS', sans-serif;\n\ttext-transform: uppercase;\n\tfont-size: .7em;\n\tcolor: #C1C1C1;\n\tline-height: 25px;\n\ttext-align: center;\n\tpadding: 0px;\n\tbackground-image: url(2_Leak_Diagnosis_Tools_files\/PhotoGray_nav_bg.png);\n\t_background-image: url(2_Leak_Diagnosis_Tools_files\/PhotoGray_nav_bg.jpg);\n\tbackground-repeat: repeat-y;\n\tborder-top: 1px solid #999;\n\tborder-bottom: 1px solid #999;\n}\n\n.navbar-bg {\n\tpadding: 6px 0px 4px 0px;\n}\n\n.navbar ul {\n\tlist-style: none;\n\tmargin: 0px;\n\tpadding: 0px 10px 0px 10px;\n}\n\n.navbar ul li {\n\tdisplay: inline; \n\tlist-style-type: none;\n\tmargin: 0px;\n\tpadding: 0px 10px 0px 10px;\n}\n\n\n.noncurrent-page  a:visited {\n\ttext-decoration: none;\n\tcolor: #C1C1C1;\n\ttext-shadow: 0px -1px 2px #333;\n}\n\n.noncurrent-page  a {\n\ttext-decoration: none;\n\tcolor: #C1C1C1;\n\ttext-shadow: 0px -1px 2px #333;\n}\n\n\n.noncurrent-page a:hover {\n\ttext-decoration: none;\n\tcolor: #EC001E;\n\ttext-shadow: 0px -1px 2px #333;\n}\n\n.current-page a\n{\n\ttext-decoration: none;\n\tcolor: #000;\n\ttext-shadow: 0px -1px 2px #7E7E7E;\n}\n\n.current-page a:visited\n{\n\ttext-decoration: none;\n\tcolor: #000;\n\ttext-shadow: 0px -1px 2px #7E7E7E;\n}\n\n", "current-page-GUID": "7F47D4D9-3681-40D5-944E-2CABD511A660", "isCollectionPage": "YES"});
//--><!]]></script>
            <div style="clear: both; height: 0px; line-height: 0px; " class="spacer"> </div>
          </div>
          <div style="height: 52px; margin-left: 0px; position: relative; width: 700px; z-index: 10; " id="header_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
            <div id="id1" style="visibility: hidden;  height: 39px; left: 30px; position: absolute; top: 13px; width: 640px; z-index: 1; " class="style_SkipStroke_1">
              <div class="text-content Normal_External_640_39" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Header"><a title="../1/6_Introduction.html" href="../1/6_Introduction.html">Windows Debugging Series</a></p>
                </div>
              </div>
              <div id="generic-header-attribute" class="Header"></div>
            </div>
          </div>
          <div style="margin-left: 0px; position: relative; width: 700px; z-index: 5; " id="body_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
            <div id="id2" style="visibility: hidden;  height: 29px; left: 30px; position: absolute; top: 389px; width: 640px; z-index: 1; " class="style_SkipStroke_2">
              <div class="text-content Normal_External_640_29" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Title">Leak Diagnosis Tools</p>
                </div>
              </div>
              <div id="generic-title-attributes" class="Title"></div>
            </div>
            


            <div id="id3" style="visibility: hidden;  height: 23px; left: 30px; position: absolute; top: 368px; width: 640px; z-index: 1; " class="style_SkipStroke_3">
              <div class="text-content Normal_External_640_23" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Date">2 de fevereiro de 2013</p>
                </div>
              </div>
              <div id="generic-datefield-attributes" class="Date"></div>
            </div>
            


            <div style="height: 340px; width: 418px;  height: 340px; left: 34px; position: absolute; top: 12px; width: 418px; z-index: 1; " class="tinyText stroke_0">
              <div style="position: relative; width: 418px; ">
                <img src="2_Leak_Diagnosis_Tools_files/shapeimage_1.jpg" alt="" style="height: 340px; left: 0px; position: absolute; top: 0px; width: 418px; visibility: hidden; " id="generic-picture-attributes" />
              </div>
            </div>
            <div style="height: 1px; line-height: 1px; " class="tinyText"> </div>
            <div style="visibility: hidden;  margin-left: 30px; margin-top: 421px; position: relative; width: 640px; z-index: 1; " class="style_SkipStroke_4 flowDefining">
              <div class="text-content Normal_External_640_824" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-top: 0pt; " class="Body">There are two useful leak diagnosis tools that shall be discussed: LeakDiag and UMDH.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">UMDH can be said as a heap manager leak tool. In addition, it requires stack tracing mode enabled by the <span class="style">gflags</span>. It is sightly complicated to collect leak information from using this tool. First, one need to collecting data:<br /></p>
                  <ol>
                    <li style="line-height: 21px; padding-left: 17px; text-indent: -17px; " class="full-width" value="1">
                      <p style="text-indent: -17px; " class="paragraph_style"><span style="font-size: 14px; " class="Bullet">1.</span><span style="width: 4px; " class="inline-block"></span>Using an administrator account, open the command prompt and run the gflags to start coolecting the stack trace for user mode allocations: <span class="style">gflags -i Program.exe +ust</span><br /></p>
                    </li>
                    <li style="line-height: 21px; padding-left: 17px; text-indent: -17px; " class="full-width" value="2">
                      <p style="text-indent: -17px; " class="paragraph_style"><span style="font-size: 14px; " class="Bullet">2.</span><span style="width: 4px; " class="inline-block"></span>Start the Program.exe and collect a baseline snapshot (this can be done from a regular command prompt): <span class="style">umdh -pn:Program.exe -f:Dump1.txt</span><br /></p>
                    </li>
                    <li style="line-height: 21px; padding-left: 17px; text-indent: -17px; " class="full-width" value="3">
                      <p style="text-indent: -17px; " class="paragraph_style_1"><span style="font-size: 14px; " class="Bullet">3.</span><span style="width: 4px; " class="inline-block"></span>Perform the action that leaks memory, and collect a second snapshot: <span class="style">umdh -pn:Program.exe -f:Dump2.txt</span><br /></p>
                    </li>
                    <li style="line-height: 21px; padding-left: 17px; text-indent: -17px; " class="full-width" value="4">
                      <p style="text-indent: -17px; " class="paragraph_style_1"><span style="font-size: 14px; " class="Bullet">4.</span><span style="width: 4px; " class="inline-block"></span>Compare the snapshots: <span class="style">umdh -d Dump1.txt Dump2.txt &gt; Diff.txt</span><br /></p>
                    </li>
                    <li style="line-height: 21px; padding-left: 17px; text-indent: -17px; " class="full-width" value="5">
                      <p style="text-indent: -17px; " class="paragraph_style_1"><span style="font-size: 14px; " class="Bullet">5.</span><span style="width: 4px; " class="inline-block"></span>Open Diff.txt in your favorite text editor (that can handle large files!). The memory leaks are listed in descending order of bytes leaked; each should be followed by the complete stack trace of the allocation call. Depending on the cause, this may either pinpoint the bug, or at least show a good place to set a breakpoint for debugging.<br /></p>
                    </li>
                    <li style="line-height: 21px; padding-left: 17px; text-indent: -17px; " class="full-width" value="6">
                      <p style="text-indent: -17px; " class="paragraph_style_1"><span style="font-size: 14px; " class="Bullet">6.</span><span style="width: 4px; " class="inline-block"></span>Stop the data collection. The most important step in the whole process is to turn off the data collection for your application (once the memory leak is fixed), or else your program will run slowly while the OS kernel logs every memory allocation: <span class="style">gflags -i Program.exe -ust</span><br /></p>
                    </li>
                  </ol>
                  <p class="Body"><br /></p>
                  <p class="Body">If <span class="style">Program.exe</span> is not a unique process name, the <span class="style">-p:</span> command line argument can select a process by ID.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body"><a class="class1" title="http://livepage.apple.com/" href="http://livepage.apple.com/">LeakDiag</a> is an independent tool provided by the Microsoft. It is both console-based and user interface tool that provides information on how much memory a process has leaked with detail information such as the stack trace and allocation statistics. It includes a superset of the UMDH tool capabilities. In addition to heap manager allocation, LeakDiag can detect leaks on:<br /></p>
                  <ol>
                    <li style="line-height: 21px; padding-left: 13px; text-indent: -13px; " class="full-width">
                      <p style="text-indent: -13px; " class="paragraph_style_2"><span style="font-size: 14px; " class="Bullet">*</span><span style="width: 4px; " class="inline-block"></span>Virtual memory allocation<br /></p>
                    </li>
                    <li style="line-height: 21px; padding-left: 13px; text-indent: -13px; " class="full-width">
                      <p style="text-indent: -13px; " class="paragraph_style_2"><span style="font-size: 14px; " class="Bullet">*</span><span style="width: 4px; " class="inline-block"></span>Heap memory allocation (default)<br /></p>
                    </li>
                    <li style="line-height: 21px; padding-left: 13px; text-indent: -13px; " class="full-width">
                      <p style="text-indent: -13px; " class="paragraph_style_2"><span style="font-size: 14px; " class="Bullet">*</span><span style="width: 4px; " class="inline-block"></span>MPHeap allocation<br /></p>
                    </li>
                    <li style="line-height: 21px; padding-left: 13px; text-indent: -13px; " class="full-width">
                      <p style="text-indent: -13px; " class="paragraph_style_2"><span style="font-size: 14px; " class="Bullet">*</span><span style="width: 4px; " class="inline-block"></span>COM (internal and external) allocation<br /></p>
                    </li>
                    <li style="line-height: 21px; padding-left: 13px; text-indent: -13px; " class="full-width">
                      <p style="text-indent: -13px; " class="paragraph_style_2"><span style="font-size: 14px; " class="Bullet">*</span><span style="width: 4px; " class="inline-block"></span>C-runtime allocation<br /></p>
                    </li>
                  </ol>
                  <p class="Body"><br /></p>
                  <p class="Body">It outputs all the information into log files in XML format, by default, in the <span class="style">C:\LeakDiag\logs</span> folder and files are named by the tool to guarantee a unique filename for each run.<br /></p>
                  <p class="Body"><br /></p>
                  <p style="padding-bottom: 0pt; " class="Body">To collect information about a process, it can be selected in GUI and then the allocation method can be selected. Then, click on the Log and then Start buttons. When the process is completed, the LeakDiag will automatically close the trace file.</p>
                </div>
              </div>
              <div id="generic-body-attributes" class="Body"></div>
            </div>
            <div style="height: 0px; line-height: 0px; " class="spacer"> </div>
          </div>
          <div style="height: 150px; margin-left: 0px; position: relative; width: 700px; z-index: 15; " id="footer_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
            <div id="id4" style="height: 30px; left: 350px; position: absolute; top: 20px; width: 319px; z-index: 1; " class="style_SkipStroke_5">
              <div class="text-content graphic_textbox_layout_style_default_External_319_30" style="padding: 0px; ">
                <div class="graphic_textbox_layout_style_default">
                  <div class="paragraph Next" style="padding-bottom: 0pt; padding-top: 0pt; "><a title="3_Application_Verifier.html" href="3_Application_Verifier.html" class="style_1">next</a><span class="style_2"> </span><div class="tinyText inline-block" style="height: 15px; position: relative; top: -3px; width: 10px; "><img usemap="#map1" id="shapeimage_2" src="2_Leak_Diagnosis_Tools_files/shapeimage_2.png" style="border: none; height: 21px; left: -3px; position: absolute; top: -3px; width: 16px; z-index: 1; " alt="" title="" /><map name="map1" id="map1"><area href="3_Application_Verifier.html" title="3_Application_Verifier.html" alt="3_Application_Verifier.html" coords="3, 3, 13, 18" /></map></div></div>
                </div>
                <div style="clear: both; height: 0px; line-height: 0px; " class="tinyText"> </div>
              </div>
            </div>
            


            <div id="id5" style="height: 30px; left: 30px; position: absolute; top: 20px; width: 320px; z-index: 1; " class="style_SkipStroke_5">
              <div class="text-content graphic_textbox_layout_style_default_External_320_30" style="padding: 0px; ">
                <div class="graphic_textbox_layout_style_default">
                  <div class="paragraph Previous" style="padding-bottom: 0pt; padding-top: 0pt; "><div class="tinyText inline-block" style="height: 15px; position: relative; width: 10px; "><img usemap="#map2" id="shapeimage_3" src="2_Leak_Diagnosis_Tools_files/shapeimage_3.png" style="border: none; height: 21px; left: -3px; position: absolute; top: -3px; width: 16px; z-index: 1; " alt="" title="" /><map name="map2" id="map2"><area href="1_Debugging_Tools_For_Windows.html" title="1_Debugging_Tools_For_Windows.html" alt="1_Debugging_Tools_For_Windows.html" coords="3, 3, 13, 18" /></map></div><span class="style_2"> </span><a title="1_Debugging_Tools_For_Windows.html" href="1_Debugging_Tools_For_Windows.html" class="style_2">previous</a></div>
                </div>
                <div style="clear: both; height: 0px; line-height: 0px; " class="tinyText"> </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>


