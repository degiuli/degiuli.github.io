<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    
    <meta name="Generator" content="iWeb 2.0.4" />
    <meta name="iWeb-Build" content="local-build-20130324" />
    <meta name="viewport" content="width=700" />
    <title>Windows Debugging Series</title>
    <link rel="stylesheet" type="text/css" media="screen,print" href="24_Stack_Corruption_files/24_Stack_Corruption.css" />
    <!--[if IE]><link rel='stylesheet' type='text/css' media='screen,print' href='24_Stack_Corruption_files/24_Stack_CorruptionIE.css'/><![endif]-->
    <script language="javascript" type="text/javascript"><!--

iWebBlogMainPageName = 'Blog.html';
iWebBlogMainPageTitle = 'Blog';
iWebBlogArchivePageName = 'Archive.html';
iWebBlogArchivePageTitle = 'Archive';
iWebBlogFeedType = 'static';


--></script>
    <script type="text/javascript" src="../../../../Scripts/iWebSite.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Widgets/SharedResources/WidgetCommon.js"></script>
    <script type="text/javascript" src="../../../../Scripts/Widgets/Navbar/navbar.js"></script>
    <script type="text/javascript" src="http://www.me.com/1/up/comments/scripts/search.js"></script>
    <script type="text/javascript" src="../../../../Scripts/iWebBlog.js"></script>
    <script type="text/javascript" src="24_Stack_Corruption_files/24_Stack_Corruption.js"></script>
  </head>
  <body style="background: #ffffff url(24_Stack_Corruption_files/PhotoGray_browser_bg-3.jpg) repeat scroll top left; margin: 0pt; " onload="onPageLoad();" onunload="onPageUnload();">
    <div style="text-align: center; ">
      <div style="margin-bottom: 0px; margin-left: auto; margin-right: auto; margin-top: 0px; overflow: hidden; position: relative; word-wrap: break-word;  text-align: left; width: 700px; " id="body_content">
        <div style="background: transparent url(24_Stack_Corruption_files/PhotoGray_bg_c-1.jpg) repeat scroll top left; width: 700px; ">
          <div style="margin-left: 0px; position: relative; width: 700px; z-index: 0; " id="nav_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
            <div style="height: 700px; width: 700px;  height: 700px; left: 0px; position: absolute; top: -80px; width: 700px; z-index: 1; " class="tinyText style_SkipStroke">
              <img src="24_Stack_Corruption_files/Darkroom_spotlight.jpg" alt="" style="border: none; height: 700px; width: 700px; " />
            </div>
            <div style="height: 1px; line-height: 1px; " class="tinyText"> </div>
            <div class="com-apple-iweb-widget-navbar flowDefining" id="widget0" style="margin-left: 0px; margin-top: 19px; position: relative; width: 700px; z-index: 1; ">
    
              <div id="widget0-navbar" class="navbar">

      
                <div id="widget0-bg" class="navbar-bg">

        
                  <ul id="widget0-navbar-list" class="navbar-list">
 <li></li> 
</ul>
                  
      
</div>
                
    
</div>
            </div>
            <script type="text/javascript"><!--//--><![CDATA[//><!--
new NavBar('widget0', '../../../../Scripts/Widgets/Navbar', '../../../../Scripts/Widgets/SharedResources', '../../../..', {"path-to-root": "..\/..\/..\/..\/", "navbar-css": ".navbar {\n\tfont-family: Futura, 'Trebuchet MS', sans-serif;\n\ttext-transform: uppercase;\n\tfont-size: .7em;\n\tcolor: #C1C1C1;\n\tline-height: 25px;\n\ttext-align: center;\n\tpadding: 0px;\n\tbackground-image: url(24_Stack_Corruption_files\/PhotoGray_nav_bg.png);\n\t_background-image: url(24_Stack_Corruption_files\/PhotoGray_nav_bg.jpg);\n\tbackground-repeat: repeat-y;\n\tborder-top: 1px solid #999;\n\tborder-bottom: 1px solid #999;\n}\n\n.navbar-bg {\n\tpadding: 6px 0px 4px 0px;\n}\n\n.navbar ul {\n\tlist-style: none;\n\tmargin: 0px;\n\tpadding: 0px 10px 0px 10px;\n}\n\n.navbar ul li {\n\tdisplay: inline; \n\tlist-style-type: none;\n\tmargin: 0px;\n\tpadding: 0px 10px 0px 10px;\n}\n\n\n.noncurrent-page  a:visited {\n\ttext-decoration: none;\n\tcolor: #C1C1C1;\n\ttext-shadow: 0px -1px 2px #333;\n}\n\n.noncurrent-page  a {\n\ttext-decoration: none;\n\tcolor: #C1C1C1;\n\ttext-shadow: 0px -1px 2px #333;\n}\n\n\n.noncurrent-page a:hover {\n\ttext-decoration: none;\n\tcolor: #EC001E;\n\ttext-shadow: 0px -1px 2px #333;\n}\n\n.current-page a\n{\n\ttext-decoration: none;\n\tcolor: #000;\n\ttext-shadow: 0px -1px 2px #7E7E7E;\n}\n\n.current-page a:visited\n{\n\ttext-decoration: none;\n\tcolor: #000;\n\ttext-shadow: 0px -1px 2px #7E7E7E;\n}\n\n", "current-page-GUID": "7F47D4D9-3681-40D5-944E-2CABD511A660", "isCollectionPage": "YES"});
//--><!]]></script>
            <div style="clear: both; height: 0px; line-height: 0px; " class="spacer"> </div>
          </div>
          <div style="height: 52px; margin-left: 0px; position: relative; width: 700px; z-index: 10; " id="header_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
            <div id="id1" style="visibility: hidden;  height: 39px; left: 30px; position: absolute; top: 13px; width: 640px; z-index: 1; " class="style_SkipStroke_1">
              <div class="text-content Normal_External_640_39" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Header"><a title="../1/6_Introduction.html" href="../1/6_Introduction.html">Windows Debugging Series</a></p>
                </div>
              </div>
              <div id="generic-header-attribute" class="Header"></div>
            </div>
          </div>
          <div style="margin-left: 0px; position: relative; width: 700px; z-index: 5; " id="body_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
            <div id="id2" style="visibility: hidden;  height: 29px; left: 30px; position: absolute; top: 38px; width: 640px; z-index: 1; " class="style_SkipStroke_2">
              <div class="text-content Normal_External_640_29" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Title">Stack Corruption</p>
                </div>
              </div>
              <div id="generic-title-attributes" class="Title"></div>
            </div>
            


            <div id="id3" style="visibility: hidden;  height: 23px; left: 30px; position: absolute; top: 10px; width: 640px; z-index: 1; " class="style_SkipStroke_3">
              <div class="text-content Normal_External_640_23" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Date">24 de fevereiro de 2013</p>
                </div>
              </div>
              <div id="generic-datefield-attributes" class="Date"></div>
            </div>
            <div style="height: 1px; line-height: 1px; " class="tinyText"> </div>
            <div style="visibility: hidden;  margin-left: 30px; margin-top: 72px; position: relative; width: 640px; z-index: 1; " class="style_SkipStroke_4 flowDefining">
              <div class="text-content Normal_External_640_3249" style="padding: 0px; ">
                <div class="Normal">
                  <p style="padding-top: 0pt; " class="paragraph_style"><span style="line-height: 23px; " class="style">What is a Stack?</span><br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">Stack is one of the most common data structure. It is pretty simple data structure that can be equated to a stack of plates or papers, where you push a new on top of it and pop from the top of it. The top is the next to be pushed or popped. In computers, the stack is in fact the lower addresses. One very good clarification about stack is the <a class="class1" title="http://eli.thegreenplace.net/2011/02/04/where-the-top-of-the-stack-is-on-x86/" href="http://eli.thegreenplace.net/2011/02/04/where-the-top-of-the-stack-is-on-x86/">Where the top of the stack is on x86</a> post from Eli Bendersky’s blog.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">In Windows system, stack is just a block of memory assigned by the operating system to a running thread. The stack is also used to track the function calls chain, including allocation of local variables and parameter passing. Once a function is called, a new frame is created on the stack and it will grows bigger and bigger as more and more functions are called. The way a function call grows in the stack depends on the CPU architecture (x86, ARM, RISC, PowerPC). The x86, which will be the focus of our discussion, has some calling conventions that directly affect how the data is placed on the stack. <br /></p>
                  <p class="Body"><br /></p>
                  <p class="paragraph_style"><span style="line-height: 22px; " class="style_1">x86 Calling Convention</span><br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">Now, let’s look at the x86 architecture calling convention. This information may be important to understand what a dump file can show. This will also describe the how a stack is filled and the function decoration (how the compiler and linker builds the name of a function). Also, calling conventions is nothing more than a contract between the caller and callee functions. It specifies rules that both must agree.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">The most important types of calling conventions are:<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body"><span class="style_2">cdecl</span><br /></p>
                  <p class="Body">cdecl, or C declaration, originates from the C language and is defined at <span style="line-height: 14px; " class="style_3">__cdecl</span>. Caller function should clear the stack. Parameters will be passed by via stack from right (on the top) to left (on the bottom). Also, the function will be prefixed by ‘_’.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">Let’s look at the sample below:<br /></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> __cdecl callee(</span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3">, </span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3">, </span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3">);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> __cdecl caller(</span><span style="line-height: 13px; " class="style_4">void</span><span style="line-height: 13px; " class="style_3">)<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">{<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3"></span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> ret;<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">ret = callee(</span><span style="line-height: 13px; " class="style_5">1</span><span style="line-height: 13px; " class="style_3">,</span><span style="line-height: 13px; " class="style_5">2</span><span style="line-height: 13px; " class="style_3">,</span><span style="line-height: 13px; " class="style_5">3</span><span style="line-height: 13px; " class="style_3">);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">ret += </span><span style="line-height: 13px; " class="style_5">5</span><span style="line-height: 13px; " class="style_3">;<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3"></span><span style="line-height: 13px; " class="style_4">return</span><span style="line-height: 13px; " class="style_3"> ret;<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">}<br /></span></p>
                  <p class="Body"><br /></p>
                  <p class="Body">Using the assembly code, the caller will firstly, push the 3 to stack, then 2 and finally 1 before call the callee function:<br /></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">push    $</span><span style="line-height: 13px; " class="style_5">3</span><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">push    $</span><span style="line-height: 13px; " class="style_5">2</span><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">push    $</span><span style="line-height: 13px; " class="style_5">1</span><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">call    _callee</span><br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">There are also few details about the registers that should be manipulated in that operation, which also depends on the type of the parameter. There are a vast number of sources that you can look for more details about this information.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body"><span class="style_2">stdcall</span><br /></p>
                  <p class="Body">stdcall is basically used by Win32, with exceptions for variadic functions, and is defined as <span style="line-height: 14px; " class="style_3">__stdcall</span>. Similar to the cdecl, it uses the stack to pass parameter, also from left to right, but it is no longer reponsible for cleaning up the stack; the called function should clear stack. Function name are decorated with ‘_’ appended by ‘@’ followed by the number of bytes of stack space required.<br /></p>
                  <p class="Body">Back to the <span style="line-height: 14px; " class="style_3">callee</span> sample above:<br /></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> __stdcall callee(</span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3">, </span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3">, </span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3">);</span><br /></p>
                  <p class="Body">it decorated name would be: <span style="line-height: 14px; " class="style_3">_callee@</span><span style="line-height: 14px; " class="style_5">12</span>, because each <span style="line-height: 14px; " class="style_4">int</span> parameter has 4 bytes.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="paragraph_style_2">fastcall<br /></p>
                  <p class="Body">fastcall, defined as <span style="line-height: 14px; " class="style_3">__fastcall</span>, is quite similar to the stdcall, except that the first two parameters is passed on ECX and EDX registers and the other are passed by stack. The called function is responsible to clear the stack and its decoration is exactly the same as stdcall.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body"><span class="style_2">thiscall</span><br /></p>
                  <p class="Body">This is default convention for for C++ member functions that do not use variable arguments. The first parameter, which is the ‘<span style="line-height: 14px; " class="style_4">this</span>’ parameter, is passed in ECX register, with the remainder passed on the stack as in stdcall. As stdcall, the called function is responsible to clear the stack. The function names are decorated by the C++ compiler in an extremely complicated mechanism that encodes the type of each parameter, among other things. This is necessary because C++ permits function overloading, so a complex decoration scheme must be used so that the various overloads have different decorated names. One interesting post about the C++ decorate names is <a class="class2" title="http://mearie.org/documents/mscmangle/" href="http://mearie.org/documents/mscmangle/">Microsoft C++ Name Mangling Scheme</a>. There are more details in <a class="class3" title="http://msdn.microsoft.com/en-us/library/56h2zst2.aspx" href="http://msdn.microsoft.com/en-us/library/56h2zst2.aspx">MSDN</a>.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="paragraph_style"><span style="line-height: 22px; " class="style_1">Calling Conventions Mismatch</span><br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">Now that stack is no longer an obscure thing in software processing, let’s start looking some stack issues. The first is the calling conventions mismatch. As introduced earlier, the different types of calling conventions lead to different way the stack is manipulated. Both caller and callee functions must agree with the rules. Let’s suppose there is DLL with one function:<br /></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">void</span><span style="line-height: 13px; " class="style_3"> __stdcall DllProc(</span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3">);</span><br /></p>
                  <p class="Body">that prints the argument and we also have an application that dynamically loads the DLL and executes the function:<br /></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">typedef</span><span style="line-height: 13px; " class="style_3"> </span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> (__cdecl *DLLPROC)(</span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3">);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">void</span><span style="line-height: 13px; " class="style_3"> CallProc(DLLPROC pProc,</span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> arg)<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">{<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    pProc(arg);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">}<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> __cdecl main(</span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> argc,</span><span style="line-height: 13px; " class="style_4">char</span><span style="line-height: 13px; " class="style_3"> *argv[])<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">{<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    HMODULE hMod = LoadLibrary(</span><span style="line-height: 13px; " class="style_6">&quot;DLL.dll&quot;</span><span style="line-height: 13px; " class="style_3">);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    </span><span style="line-height: 13px; " class="style_4">if</span><span style="line-height: 13px; " class="style_3">(mod)<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    {<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">        DLLPROC pProc = (DLLPROC)GetProcAddress(hMod,</span><span style="line-height: 13px; " class="style_6">&quot;DllProc&quot;</span><span style="line-height: 13px; " class="style_3">);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">        </span><span style="line-height: 13px; " class="style_4">if</span><span style="line-height: 13px; " class="style_3">(pProc)<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">        {<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">            CallProc(pProc,argc);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">        }<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">        FreeLibrary(hMod);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    }<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">}<br /></span></p>
                  <p class="Body"><br /></p>
                  <p class="Body">The code is can be compiled and linked. Running the application may not cause any issue and there will be an output but would not be the expected one simply because the calling conventions. The <span class="style_7">main</span> function will not expect the <span class="style_7">DLL!DllProc</span> to cleanup the stack, but it will as defined as <span class="style_7">__stdcall</span>. Before the <span class="style_7">DLL!DllProc</span> returns, it is responsible to cleanup the stack, which means it will modify the registers accordingly. However, the main function will also perform the same operation because it believes the <span class="style_7">DLL!DllProc</span> will not do it due to the fact the function pointer is set as <span class="style_7">__cdecl</span>.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">This modifies the stack and causes unpredictable issues. In this specific case, it may probably run the <span class="style_7">DLL!DllProc</span> again. If this example is run under a debugger, this will show an exception.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="paragraph_style"><span style="line-height: 22px; " class="style_1">Stack Overrun</span><br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">Stack overrun, also know as buffer overflow or stack buffer overflow, occurs when a thread indiscriminately overwrites portions of its call stack reserved for other purpose. Examples of this issue are overwriting the return address for a particular frame, overwriting entire frame, exhausting the stack completely. The effects of stack overrun range from crash, unpredictable behavior and even critical security holes.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">One common mistake that causes this issue is copying a string to a smaller area. Take the following sample code below:<br /></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">void</span><span style="line-height: 13px; " class="style_3"> foo(</span><span style="line-height: 13px; " class="style_4">char</span><span style="line-height: 13px; " class="style_3"> *pdata)<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">{<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    </span><span style="line-height: 13px; " class="style_4">char</span><span style="line-height: 13px; " class="style_3"> data[</span><span style="line-height: 13px; " class="style_5">10</span><span style="line-height: 13px; " class="style_3">] = {</span><span style="line-height: 13px; " class="style_5">0</span><span style="line-height: 13px; " class="style_3">};    </span><span style="line-height: 13px; " class="style_8">//stack memory</span><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    strcpy(data,pdata);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    std::cout &lt;&lt; data &lt;&lt; std::endl;<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">}<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> main(</span><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> argc, </span><span style="line-height: 13px; " class="style_4">char</span><span style="line-height: 13px; " class="style_3"> *argv[])<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">{<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    </span><span style="line-height: 13px; " class="style_4">if</span><span style="line-height: 13px; " class="style_3">(argc&gt;</span><span style="line-height: 13px; " class="style_5">1</span><span style="line-height: 13px; " class="style_3">)<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    {<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">        </span><span style="line-height: 13px; " class="style_8">//pass first argument to function</span><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">        foo(argv[</span><span style="line-height: 13px; " class="style_5">1</span><span style="line-height: 13px; " class="style_3">]);<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    }<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_9">    </span><span style="line-height: 13px; " class="style_4">return</span><span style="line-height: 13px; " class="style_3"> </span><span style="line-height: 13px; " class="style_5">0</span><span style="line-height: 13px; " class="style_3">;<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">}</span><br /></p>
                  <p class="Body">What would happen if the argv[1] string is bigger than 10 bytes? A crash would occur because the characters beyond the 10th position, characters out of the allocated memory boundaries, would write the stack memory changing its contents, causing this memory to be invalid. If this memory is, for instance, an instruction address, it can certainly redirect the application execution to wrong path. So, the consequence is a security hole. A hacker can inject a piece of code to gain access to the system by using this technic.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="paragraph_style"><span style="line-height: 22px; " class="style_1">Stack Overflow</span><br /></p>
                  <p class="Body"><br /></p>
                  <p class="Body">Stack overflow usually occurs when too much memory is used on stack, which contains a limited amount of memory. The memory size available on stack depends on the language used, the machine architecture, multi-threading, and the amount memory available. When an application attempts to allocate more stack memory that available, it typically crashes as a result of the overflow. The two main reason that results in stack overflow are:<br /></p>
                  <ol>
                    <li style="line-height: 21px; padding-left: 13px; text-indent: -13px; " class="full-width">
                      <p style="text-indent: -13px; " class="paragraph_style_3"><span style="font-size: 14px; " class="Bullet">*</span><span style="width: 4px; " class="inline-block"></span>very or infinite recursion:<br /></p>
                    </li>
                  </ol>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> foo();<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">{<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    </span><span style="line-height: 13px; " class="style_4">return</span><span style="line-height: 13px; " class="style_3"> foo();<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">}</span><br /></p>
                  <ol>
                    <li style="line-height: 21px; padding-left: 13px; text-indent: -13px; " class="full-width">
                      <p style="text-indent: -13px; " class="paragraph_style_3"><span style="font-size: 14px; " class="Bullet">*</span><span style="width: 4px; " class="inline-block"></span>very large stack variable:<br /></p>
                    </li>
                  </ol>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_4">int</span><span style="line-height: 13px; " class="style_3"> foo();<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">{<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    </span><span style="line-height: 13px; " class="style_4">double</span><span style="line-height: 13px; " class="style_3"> very_large_array[</span><span style="line-height: 13px; " class="style_5">1000000</span><span style="line-height: 13px; " class="style_3">];<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    </span><span style="line-height: 13px; " class="style_8">//do something ...</span><span style="line-height: 13px; " class="style_3"><br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">    </span><span style="line-height: 13px; " class="style_4">return</span><span style="line-height: 13px; " class="style_3"> something...;<br /></span></p>
                  <p class="paragraph_style_1"><span style="line-height: 13px; " class="style_3">}<br /></span></p>
                  <p class="Body">There are two basic rules to avoid this issue: (1) be care when doing recursion, always verifying completely the out case there is no infinite recursion or it is called so many times; (2) do not use much stack variable by allocating any variable greater than 256 bytes.<br /></p>
                  <p class="Body"><br /></p>
                  <p class="paragraph_style"><span style="line-height: 22px; " class="style_1">Stack Underrun</span><br /></p>
                  <p class="Body"><br /></p>
                  <p style="padding-bottom: 0pt; " class="Body">Stack underrun errors as less common, but it can occurs when the stack to be read becomes empty.</p>
                </div>
              </div>
              <div id="generic-body-attributes" class="Body"></div>
            </div>
            <div style="height: 0px; line-height: 0px; " class="spacer"> </div>
          </div>
          <div style="height: 150px; margin-left: 0px; position: relative; width: 700px; z-index: 15; " id="footer_layer">
            <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
            <div id="id4" style="height: 30px; left: 350px; position: absolute; top: 20px; width: 319px; z-index: 1; " class="style_SkipStroke_5">
              <div class="text-content graphic_textbox_layout_style_default_External_319_30" style="padding: 0px; ">
                <div class="graphic_textbox_layout_style_default">
                  <div class="paragraph Next" style="padding-bottom: 0pt; padding-top: 0pt; "><a title="24_Heap_Corruption.html" href="24_Heap_Corruption.html" class="style_10">next</a><span class="style_11"> </span><div class="tinyText inline-block" style="height: 15px; position: relative; top: -3px; width: 10px; "><img usemap="#map1" id="shapeimage_1" src="24_Stack_Corruption_files/shapeimage_1.png" style="border: none; height: 21px; left: -3px; position: absolute; top: -3px; width: 16px; z-index: 1; " alt="" title="" /><map name="map1" id="map1"><area href="24_Heap_Corruption.html" title="24_Heap_Corruption.html" alt="24_Heap_Corruption.html" coords="3, 3, 13, 18" /></map></div></div>
                </div>
                <div style="clear: both; height: 0px; line-height: 0px; " class="tinyText"> </div>
              </div>
            </div>
            


            <div id="id5" style="height: 30px; left: 30px; position: absolute; top: 20px; width: 320px; z-index: 1; " class="style_SkipStroke_5">
              <div class="text-content graphic_textbox_layout_style_default_External_320_30" style="padding: 0px; ">
                <div class="graphic_textbox_layout_style_default">
                  <div class="paragraph Previous" style="padding-bottom: 0pt; padding-top: 0pt; "><div class="tinyText inline-block" style="height: 15px; position: relative; width: 10px; "><img usemap="#map2" id="shapeimage_2" src="24_Stack_Corruption_files/shapeimage_2.png" style="border: none; height: 21px; left: -3px; position: absolute; top: -3px; width: 16px; z-index: 1; " alt="" title="" /><map name="map2" id="map2"><area href="23_Memory_Corruption.html" title="23_Memory_Corruption.html" alt="23_Memory_Corruption.html" coords="3, 3, 13, 18" /></map></div><span class="style_11"> </span><a title="23_Memory_Corruption.html" href="23_Memory_Corruption.html" class="style_11">previous</a></div>
                </div>
                <div style="clear: both; height: 0px; line-height: 0px; " class="tinyText"> </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>


